# Learned Lessons

This document describes some of the things I learned about solidity and/or
Ethereum during this development cycle.

## Who can call a function?

Often, you will want to prevent others from modifying a function, for example
how much an investor can still receive as a ROI. Based on
[this](https://ethereum.stackexchange.com/a/137947) answer, with zero upvotes,
a typical way to do this is:

```sol
contract B {
  address addressA;

  modifier onlyACanCall() {
    require(msg.sender == addressA);
  }
  constructor(address _A) {
    addressA = _A;
  }
  function onlyA() external onlyACanCall {
      // ...
  }
}
```

Or you could make some contract Ownable. I did not yet look up what that is.

## SafeMath

As of solidity 0.8.x the SafeMath checks against overflow and underflow are
embedded in the compiler. This means you don't have to use the `a.mul()`
operations anymore, because the checks that are called in the `mul()` operation
of safemath, are done by the compiler. I don't know actually how that can be
done by the compiler when the values are coming in at runtime. Probably the
compiler embeds those checks in the generated bytecode, such that those checks
are performed at runtime automatically.

## Definitions

- **public** - all can access
- **external** - Cannot be accessed internally, only externally
- **internal** - only this contract and contracts deriving from it can access
- **private** - can be accessed only from this contract

As you can notice **private** is a subset of **internal** and **external** is
a subset of **public**.

## Order

```sol
// SPDX-License-Identifier: GPL-3.0
pragma solidity >=0.7.0 <0.9.0;
contract A {
    constructor() {
        // ...
    }

    receive() external payable {
        // ...
    }

    fallback() external {
        // ...
    }

    // External functions
    // ...

    // External functions that are view
    // ...

    // External functions that are pure
    // ...

    // Public functions
    // ...

    // Internal functions
    // ...

    // Private functions
    // ...
}
```

## \_something (underscores)

I thought underscores before a variable were used because they are private.
And they are, or they are internal [Source](https://docs.soliditylang.org/en/latest/style-guide.html#underscore-prefix-for-non-external-functions-and-variables).

**Incorrect [source](https://ethereum.stackexchange.com/questions/56443/what-does-mean-before-a-variable-name)**
Instead they are used to not overwrite/"shadow" variables of the same name in
a contract. So incoming argument parameters are written with _ before them.
This **cannot** yield patterns like:

```sol
constructor(address[] _payees) public payable {
    payees = _payees
  }
```

where the internal variable `payees` is given the value of the incoming
argument `_payees`.
